  <%- include('./partials/header') %> <%- include('./partials/nav') %>

  <!-- Profile Header Section -->
  <section
    class="w-full bg-[#4f46e5] text-white py-16 flex flex-col items-center"
  >
    <div class="max-w-4xl text-center px-4">
      <div class="relative mb-5">
        <img
          src="<%= user.avatar.startsWith('https') ? user.avatar : '/' + user.avatar %>"
          alt="User Avatar"
          class="rounded-full h-40 w-40 mx-auto shadow-lg"
        />
      </div>
      <div class="flex gap-3 items-center justify-center mb-5">
        <div class="w-[50px]">
          <div class="text-[18px]"><%=user.posts.length %></div>
          <p class="text-[12px]">Posts</p>
        </div>
        <div class="w-[50px]">
          <div class="text-[18px]"><%= user.followers.length %></div>
          <p class="text-[12px]">Followers</p>
        </div>
        <div class="w-[50px]">
        

          <div class="text-[18px]"><%= user.following.length %></div>
          <p class="text-[12px]">Following</p>
        </div>
      </div>
      <h1 class="text-4xl font-bold mb-2"><%= user.username %></h1>
      <p class="text-lg mb-6"><%= user.bio %></p>
      <% if (user._id !== loginUserId) { %>
        
        <button id="followBtn"
        onclick="followUnFollowLogic(`<%=loginUserId%>`,`<%=user._id%>`,`<%= JSON.stringify(user) %>`,`<%=JSON.stringify(loginUser)%>`)"
        class="inline-block bg-white text-[#4f46e5] font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-200 transition duration-300">
  <%=user.followers.includes(loginUserId) ? 'Following' :  'Follow' %>

  </button>


      <% }else { %>
      <a
        href="/update-profile"
        class="inline-block bg-white text-[#4f46e5] font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-200 transition duration-300"
        >Edit Profile</a
      >
      <% } %>
    </div>
  </section>

  <!-- User Details Section -->
  <section class="w-full py-16 bg-white-300 text-gray-700">
    <div class="max-w-5xl mx-auto px-4">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- User Information -->
        <div
          class="lg:col-span-1 bg-white p-8 rounded-lg border-[0.5px] shadow-lg"
        >
          <h2 class="text-2xl font-bold mb-6 text-[#4f46e5]">
            Profile Information
          </h2>
          <ul class="space-y-4">
            <li><strong>Email:</strong> <%= user.email %></li>
            <li><strong>Location:</strong> <%= user.location %></li>
            <li><strong>Member Since:</strong> January 2023</li>
            <li><strong>Interests:</strong> <%=user.interests %></li>
            <li>
              <strong>Website:</strong>
              <a href="<%= user.website %>" class="text-[#4f46e5] hover:underline"
                ><%= user.website %></a
              >
            </li>
          </ul>
        </div>

        <!-- User Activities -->
        <div class="lg:col-span-2">
          <!-- Recent Posts -->
          <div class="bg-white p-8 rounded-lg border-[0.5px] shadow-lg mb-8">
            <h2 class="text-2xl font-bold mb-6 text-[#4f46e5]">Recent Posts</h2>
            <ul class="space-y-4">
              <!-- Post 1 -->
              <li class="border-b pb-4">
                <h3 class="text-xl font-bold">Participated in Beach Cleanup</h3>
                <p class="text-gray-600">
                  Contributed to the community beach cleanup initiative. Great
                  teamwork and impactful results!
                </p>
                <span class="text-sm text-gray-500">Posted on June 15, 2024</span>
              </li>
              <!-- Post 2 -->
              <li class="border-b pb-4">
                <h3 class="text-xl font-bold">Organized a Local Charity Event</h3>
                <p class="text-gray-600">
                  Successfully organized a charity event to support local families
                  in need. Raised over $5,000!
                </p>
                <span class="text-sm text-gray-500">Posted on May 30, 2024</span>
              </li>
            </ul>
          </div>
          <!-- Recent Activities -->
          <div class="bg-white p-8 border-[0.5px] rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-6 text-[#4f46e5]">
              Recent Activities
            </h2>
            <ul class="space-y-4">
              <!-- Activity 1 -->
              <li class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 text-[#4f46e5] mr-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                <p>Joined the <strong>Climate Action Group</strong></p>
              </li>
              <!-- Activity 2 -->
              <li class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 text-[#4f46e5] mr-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                <p>Attended <strong>Community Gardening Workshop</strong></p>
              </li>
              <!-- Activity 3 -->
              <li class="flex items-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6 text-[#4f46e5] mr-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                <p>Donated to <strong>Local Food Bank</strong></p>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Call to Action Section -->
  <section
    class="w-full bg-[#4f46e5] text-white py-16 flex flex-col items-center"
  >
    <div class="max-w-3xl text-center px-4">
      <h2 class="text-4xl font-bold mb-6">Get More Involved with BeSocial!</h2>
      <p class="text-lg leading-relaxed mb-6">
        Discover more ways to contribute, connect with new groups, and join
        activities that matter. Explore now!
      </p>
      <a
        href="/users/logout"
        class="inline-block bg-white text-[#4f46e5] font-bold py-3 px-8 rounded-lg shadow-md hover:bg-gray-200 transition duration-300"
        >Logout</a
      >
    </div>
  </section>

  <%- include('./partials/footer') %>

  <script>

    async function followUnFollowLogic(loginUserId,userId,user,loginUser ){

      try {

        const objuser = JSON.parse(user)
        const objloginuser = JSON.parse(loginUser)



       

        if(objloginuser.following.includes(userId) && objuser.followers.includes(loginUserId)){
          console.log("unfollow")
          await unFollowUser(userId)
        }else{
          console.log("follow")
          await followUser(userId)
        }
      
      } catch (error) {
        console.error("Error parsing user object:", error);
        alert("An error occurred. Please try again later.");
        return;
      }
      
  }
    
  async function followUser(userId) {
      const followBtn = document.getElementById('followBtn');
      console.log(userId);
      try {
        const response = await fetch(`/users/followUser/${userId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });
        if (response.ok) {
          // Assuming the server sends a message on successful follow
          // followBtn.textContent = 'Following'
          alert("Following successfully!");
        } else {
          // followBtn.textContent = 'Follow'
          alert(`Failed to follow: ${error.message || "Unknown error"}`);
        }
      } catch (error) {
        console.error("Error following user:", error);
        alert("An error occurred while trying to follow the user.");
        // followBtn.textContent = 'Follow'
      }
    }

    async function unFollowUser(userId) {
      const followBtn = document.getElementById('followBtn');
      try {
        const response = await fetch(`/users/unFollowUser/${userId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });
        console.log(response);
        if (response.ok) {
          // Assuming the server sends a message on successful follow
          // followBtn.textContent = 'Follow'
          alert("unFollow successfully!");
        } else {
          // Handle non-OK responses, including a possible error message from the server
          // followBtn.textContent = 'Following'
          alert(`Failed to follow: ${error.message || "Unknown error"}`);
        }
      } catch (error) {
        // Catch network errors or other unexpected issues
        console.error("Error following user:", error);
        // followBtn.textContent = 'Following'
        alert("An error occurred while trying to follow the user.");
      }
    }
  </script>
